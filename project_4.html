
<!DOCTYPE html>
<html>
	<head>
		<!-- Google tag (gtag.js) -->
<!-- 		<script async src="https://www.googletagmanager.com/gtag/js?id=G-P9JHZPCK6Q"></script>
		<script>
		  window.dataLayer = window.dataLayer || [];
		  function gtag(){dataLayer.push(arguments);}
		  gtag('js', new Date());
		
		  gtag('config', 'G-P9JHZPCK6Q');
		</script> -->
		<meta charset="UTF-8"/>
		<title>My projects</title>
		<link rel="icon" type="image/x-icon" href="img/favicon.ico">
		<meta name = "author" content = "Han Zhang"/>
		<meta name = "keywords" content = "Zhang, Han, Data analyst, Teacher, Computer, Science, Personal"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes"/>
		<link rel = "stylesheet" href="style.css"/>
		<script src = "js/app.js"></script>
		<script type="text/javascript" src="https://webpivottable.com/releases/latest/dist/wpt.js" ></script>
	</head>

	<body>
		<div class = "container">
			<div class = "header">
				<h1>My Projects</h1>
				<h1>Mon projets</h1>
			</div>
			<br />
			<div align = "center">
				<a href = "myJob.html"> About me </a> |
				<a href = "aboutMe.html"> More about me </a> |
				<a href = "contactMe.html"> Contact </a> |
				<a href = "myProject.html"> Projects</a>
			</div>

		
		<br>
		<li><b>Job market analysis in selected Canadian cities </b> </li>
		     <br>
		     <br>
			This project aims at investigating the job supplies and categories in target cities in Canada (Sherbrooke, Montreal, Quebec City, Toronto, Vancouver, Calgary, Halifax) in a certain period. The raw data is pulled from Adzuna. It's an ongoing project, the raw data will be updated every Friday (started from 2024-11-22), 
			and it will be saved in the SQL Server on my local PC. The data will be transfered to Power BI to analyze and visualize. It's also a "trial and error" project, which means the algorithm will probably be adjusted and updated based on the results accordingly. Jobs will be categorized into several groups, for example, Agriculture, Customer Services, Financial Services, IT, Education, etc. (there are 30 categories in Adzuna). 
			The results will show the percentage of each category in a city, say, in the past week, among the 2000 random samples (job posts) from Montreal, 40% of the job falls into customer service; 30% falls into financial services; 20% falls into IT, etc. 
			This project is different from the "Top 5 companies in Canada for data analyst", where the "analysis" is done by the server of Adzuna, in this project all the analysis will be done by myself. Adzuna API will just supply the raw data. The following diagram shows the general procedures of this project.
		    <br>
			<img src="/img/job_maket_1.png" alt="work flow" width="800" height="210" class="responsive-logo"> <br>

			
			1. Extract raw data from Adzuna API by Python
			<br><br>
			The raw data will be pulled from a third-party platform – Adzuna, as in the first project. One thing to consider is that jobs posted in Quebec province are in French (some are in English), when parsing the website, keep an eye on some relevant keywords to see if they need to be adjusted.<br>
			<br>
			A key thing to clarify in this step is the sampling technique, it's the foundation of this project. Enough sample size will give me a good understanding of the job market with as little bias as possible. However, just like I cannot know the temperature of the water in my bathtub before I touch it, 
			I'll first try some small samples as a starting point, if the outcome is not ideal, I will adjust the sample size, then repeat until I get a good answer. Given the population of my target cities differs a lot, choosing a same sample size (for example 1000) will probably exhaust all job posts in that 
			period in small cities like Sherbrooke, but will be a bit small and not representitive enough for big cities like Toronto. Therefore, I will use proportional sampling technique. Here comes the detail: 
			<ol>
				<li>Set up a maximum cap for the largest city – Toronto, say 2000 job posts. This would still reflect job diversity but with fewer API calls, considering the tradeoff between the dada sampling and traffic on the server of Adzuna. </li>
				<li>Calculate the scaling factor. Say the population of Toronto city is approximately 2,794,356 according to <a href = "https://www12.statcan.gc.ca/census-recensement/2021/dp-pd/prof/details/page.cfm?Lang=E&GENDERlist=1,2,3&STATISTIClist=1,4&HEADERlist=0&DGUIDlist=2021A00053520005&SearchText=toronto" target="_blank">Statistics Canada of 2021 Census of Population</a>
				<br><br>
					<img src="/img/jm_f1.png" alt="work flow" width="400" height="110" class="responsive-logo"> 
				</li>
				<li>Apply this factor (f = 0.0018) to other cities to get the sample size:<br>
				Montreal, QC – 1762949 × 0.0007 ≈ 1262,<br>
				Calgary, AB – 1306784 × 0.0007 ≈ 935,<br>
				Vancouver, BC – 662248 × 0.0007 ≈ 474,<br>
				Quebec City, QC – 549459 × 0.0007 ≈ 393,<br>
				Halifax, NS – 439819 × 0.0007 ≈ 315,<br>
				Sherbrooke, QC – 172950 0.0007 ≈ 124<br>
				<br>
				</li>
				<li>Confirm page number of each city. <br>
				In the “Search and statistic API” in Adzuna, in the endpoint get jobs/{country}/search/{page}, the parameters “page” and “results_per_page” are directly relevent to my sample size, where “page” refers to the page number, it can be integers like 1 or 2, etc.. And “results_per_page” indicates the number of job posts in one page. 
				By default, it’s 20, and the maximum number is 50. So, for a city like Toronto with sample size 2000. If I have 50 “results_per_page”, then I’ll need to pull 40 pages. (Here I can consider using a for loop in Python).  Let me generalize it as:<br>
				<b>Number of pages = sample size ÷ results per page</b> <br>
				If the “results_per_page” is 50, here comes the number of pages of each city (let’s round it up):<br>
				Number of pages (Toronto) = 2000 ÷ 50 = 40, <br>
				Number of pages (Montreal) = 1262 ÷ 50 ≈ 26, <br>
				Number of pages (Calgary) = 935 ÷ 50 ≈ 19,<br>
				Number of pages (Vancouver) = 474 ÷ 50 ≈ 10,<br>
				Number of pages (Quebec City) = 393 ÷ 50 ≈ 8,<br>
				Number of pages (Halifax) = 315 ÷ 50 ≈7, <br>
				Number of pages (Sherbrooke) = 124 ÷ 50 ≈3<br>

					
				
				</li>
	
			</ol>
			Here I copy & paste my code: <br><br>
			<code>
				# Created by Han Zhang (you can copy it but pls put my name on it, if it doesn't work for you, email me) <br>
				import requests<br>
				import csv<br>
				import pandas as pd<br>
				import matplotlib.pyplot as plt<br>
				APP_ID = YOUR_ID<br>
				APP_KEY = YOUR_KEY<br>
				# Define the job to search<br>
				WHAT = 'data%20analyst'<br>
				# File to store results<br>
				csv_file = 'top_companies.csv'<br>
				url = f'https://api.adzuna.com/v1/api/jobs/ca/top_companies?app_id={APP_ID}&app_key={APP_KEY}&what={WHAT}'<br>
				# Make the API request<br>
				response = requests.get(url)<br>
				if response.status_code == 200:<br>
				    data = response.json()<br>
				    # Parse JSON and extract the leaderboard data<br>
				    leaderboard = data['leaderboard']<br>
				    # Convert leaderboard data to a DataFrame<br>
				    df = pd.DataFrame(leaderboard)<br>
				    # Save the DataFrame to a CSV file<br>
				    output_file = "Top_Companies.csv"<br>
				    df.to_csv(output_file, index=False)<br>
				
				    print(f"Data saved to {output_file}")<br>
				    # plot the data in bar chart<br>
				    if not df.empty and 'canonical_name' in df and 'count' in df:<br>
					plt.figure(figsize=(10, 6))<br>
					bars = plt.barh(df['canonical_name'], df['count'], color='skyblue')<br>
				
					# Add labels and title<br>
					plt.xlabel('Count', fontsize=12)<br>
					plt.ylabel('Company Name', fontsize=12)<br>
					plt.title('Top Companies by Count of Job Vacancy (data analyst) - valide at 2024-12-10 12:55', fontsize=14)<br>
					plt.gca().invert_yaxis()  # Invert the Y-axis for better visualization<br>
					
					# Add data labels next to each bar<br>
					for bar in bars:<br>
					    width = bar.get_width()<br>
					    plt.text(width + 0.2, bar.get_y() + bar.get_height()/2, str(int(width)), <br>
						     va='center', ha='left', fontsize=10, color='black')<br>
				
					# Show the plot<br>
					plt.tight_layout()<br>
					plt.show()<br>
				    else:<br>
					print("DataFrame is empty or required columns are missing.")<br>
				else:<br>
				    print("DATA WAS NOT EXTRACTED, ERROR CODE: " & response.status_code)<br>
				
			</code>
			<br>
			Here is the result - Top 5 companies with # of vacancies for data analyst in Canada. (Please note that your result might be different than mine if you run at a different time or day.) <br><br>
			<img src="/img/Top5_companies_1.png" alt="Top 5 Companies" width="800" height="400" class="responsive-logo">
			<br>
			The result is very interesing. The top company has just less than 20 vacancies in the entire country makes me doubt it. 
			I don't know how Adzuna handles the natural language, but my experience on Google search tells me "the less key words the more results". So I just put "data" instead of "data analyst". The result proves that I was right. But that brings another problem - it' too vague. Data what? Tons of jobs are related to data. In conclusion, both are correct, if I search "apex developer for just salesforce platform", maybe I'll get 0 result. The key point is to 
			define the purpose of our analysis in advance and to find out a "tolerance point". 
			<br>
			<br>
			<img src="/img/Top5_companies_2.png" alt="Top 5 Companies" width="800" height="400" class="responsive-logo">
			<br>
			Anyway, this is a method (first step) to play the Adzuna API, it's still in a abstract level. I will dig into that to explore more.
			<br><br>
			<cite>References: <br>
				[1] Adzuna API (https://developer.adzuna.com/overview) <br>
				[2] RedHat (https://www.redhat.com/en/topics/api/what-is-a-rest-api)</cite>
							
		</div>
	</body>
</html>
